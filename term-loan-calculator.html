---
layout: default
title: "Term Loan Calculator | Nicolasâ€¯Lescalier"
---

<div class="container">
  <div class="calculator">
    <h1>Loan Calculator</h1>
    <p class="instructions">
      Check the boxes next to the three fields you want to provide; 
      the calculator will compute the remaining field automatically.
    </p>

    <div class="form-grid">
      <div class="field">
        <label for="loanAmount">Loan Amount ($)</label>
        <div class="input-row">
          <!-- Added inline style="font-size:1.1rem; padding:0.75rem;" -->
          <input
            id="loanAmount" 
            type="text" 
            value="350,000.00"
            style="font-size: 1.1rem; padding: 0.75rem;"
            onfocus="this.value=parseFloat(this.value.replace(/,/g,''))||''"
            onblur="this.value=Number(this.value||0).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2})"
          />
          <input id="lockAmount" type="checkbox" checked />
        </div>
      </div>

      <div class="field">
        <label for="interestRate">Interest Rate (%)</label>
        <div class="input-row">
          <!-- Added inline style="font-size:1.1rem; padding:0.75rem;" -->
          <input
            id="interestRate" 
            type="text" 
            value="10.50" 
            step="0.01"
            style="font-size: 1.1rem; padding: 0.75rem;"
            onfocus="this.value=parseFloat(this.value)||''"
            onblur="this.value=Number(this.value||0).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2})"
          />
          <input id="lockRate" type="checkbox" checked />
        </div>
      </div>

      <div class="field">
        <label for="loanTerm">Loan Term (years)</label>
        <div class="input-row">
          <!-- Added inline style="font-size:1.1rem; padding:0.75rem;" -->
          <input
            id="loanTerm" 
            type="text" 
            value="10.00" 
            step="0.01"
            style="font-size: 1.1rem; padding: 0.75rem;"
            onfocus="this.value=parseFloat(this.value)||''"
            onblur="this.value=Number(this.value||0).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2})"
          />
          <input id="lockTerm" type="checkbox" checked />
        </div>
      </div>

      <div class="field">
        <label for="payment">Monthly Payment ($)</label>
        <div class="input-row">
          <!-- Added inline style="font-size:1.1rem; padding:0.75rem;" -->
          <input
            id="payment" 
            type="text" 
            value="4,722.72"
            style="font-size: 1.1rem; padding: 0.75rem;"
            onfocus="this.value=parseFloat(this.value.replace(/,/g,''))||''"
            onblur="this.value=Number(this.value||0).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2})"
          />
          <input id="lockPayment" type="checkbox" />
        </div>
      </div>
    </div>

    <div class="schedule-actions">
      <div class="freq">
        <label for="frequency">Amortization Frequency:</label>
        <select id="frequency">
          <option value="monthly">Monthly</option>
          <option value="annual" selected>Annual</option>
        </select>
      </div>
      <button id="download">Download PDF</button>
    </div>

    <table>
      <thead>
        <tr>
          <th id="hdrPeriod">Year</th>
          <th>Payment</th>
          <th>Principal</th>
          <th>Interest</th>
          <th>Balance</th>
        </tr>
      </thead>
      <tbody id="schedule"></tbody>
    </table>
  </div>
</div>

<script>
  const $ = id => document.getElementById(id),
        fmt = n => Number(n).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2}),
        parseN = str => parseFloat(str.replace(/,/g,'')) || 0;

  function state() {
    const A = parseN($('loanAmount').value),
          R = parseN($('interestRate').value) / 100 / 12,
          Y = parseN($('loanTerm').value),
          N = Math.round(Y * 12),
          P = parseN($('payment').value);

    return {
      A,
      R,
      Y,
      N,
      P,
      freq: $('frequency').value,
      locks: {
        loanAmount: $('lockAmount').checked,
        interestRate: $('lockRate').checked,
        loanTerm: $('lockTerm').checked,
        payment: $('lockPayment').checked
      }
    };
  }

  function solveMissing(s) {
    const { A, R, N, P, locks } = s;
    if (!locks.payment)
      return A * R / (1 - Math.pow(1 + R, -N));

    if (!locks.loanAmount)
      return P * (1 - Math.pow(1 + R, -N)) / R;

    if (!locks.loanTerm)
      return Math.ceil(
        (-Math.log(1 - (A * R) / P) / Math.log(1 + R)) / 12 * 100
      ) / 100;

    if (!locks.interestRate) {
      let r = 0.01;
      for (let i = 0; i < 20; i++) {
        const f = P * (1 - Math.pow(1 + r, -N)) / r - A;
        const df =
          (-P * (1 - Math.pow(1 + r, -N))) / (r * r) +
          (P * N * Math.pow(1 + r, -N - 1)) / r;
        r -= f / df;
        if (r <= 0) r = Math.abs(r);
      }
      return r * 12 * 100;
    }
    return 0;
  }

  function renderSchedule() {
    const s = state(),
          tbody = $('schedule');
    tbody.innerHTML = '';
    $('hdrPeriod').textContent = s.freq === 'monthly' ? 'Month' : 'Year';

    let bal = s.A;
    if (s.freq === 'monthly') {
      for (let i = 1; i <= s.N; i++) {
        const interest = bal * s.R,
              principal = s.P - interest;
        bal -= principal;

        const tr = tbody.insertRow();
        tr.innerHTML = `
          <td>${i}</td>
          <td>${fmt(s.P)}</td>
          <td>${fmt(principal)}</td>
          <td>${fmt(interest)}</td>
          <td>${fmt(Math.max(bal, 0))}</td>
        `;
      }
    } else {
      let monthsLeft = s.N,
          year = 1;
      while (monthsLeft > 0) {
        let yPay = 0, yPr = 0, yInt = 0,
            count = Math.min(12, monthsLeft);

        for (let j = 0; j < count; j++) {
          const interest = bal * s.R,
                principal = s.P - interest;
          yInt += interest;
          yPr += principal;
          yPay += s.P;
          bal -= principal;
        }

        const tr = tbody.insertRow();
        tr.innerHTML = `
          <td>${year}</td>
          <td>${fmt(yPay)}</td>
          <td>${fmt(yPr)}</td>
          <td>${fmt(yInt)}</td>
          <td>${fmt(Math.max(bal, 0))}</td>
        `;
        monthsLeft -= count;
        year++;
      }
    }
  }

  function calculate() {
    const s = state(),
          missing = Object.keys(s.locks).find(k => !s.locks[k]),
          val = solveMissing(s);

    const map = {
      payment: 'payment',
      loanAmount: 'loanAmount',
      interestRate: 'interestRate',
      loanTerm: 'loanTerm'
    };
    $(map[missing]).value = fmt(val);
    renderSchedule();
  }

  // Download PDF handler
  $('download').onclick = () => {
    calculate();
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit: 'pt', format: 'a4' });
    doc.setFontSize(12);
    doc.text(`Loan Amount: ${$('loanAmount').value}`, 40, 40);
    doc.text(`Interest Rate (%): ${$('interestRate').value}`, 40, 55);
    doc.text(`Loan Term (years): ${$('loanTerm').value}`, 40, 70);
    doc.text(`Payment: ${$('payment').value}`, 40, 85);

    doc.setFontSize(14);
    doc.text('Amortization Schedule', 40, 110);

    const head = [[
      $('hdrPeriod').textContent,
      'Payment',
      'Principal',
      'Interest',
      'Balance'
    ]];
    const body = Array.from($('schedule').rows).map(r =>
      Array.from(r.cells).map(td => td.textContent)
    );

    // @ts-ignore
    doc.autoTable({
      head,
      body,
      startY: 125,
      theme: 'grid'
    });
    doc.save('term-loan-schedule.pdf');
  };

  // Attach real-time validation and calculation
  ['loanAmount','interestRate','loanTerm','lockAmount','lockRate','lockTerm','lockPayment','frequency']
    .forEach(id => $(id).addEventListener('change', calculate));
  ['loanAmount','interestRate','loanTerm','payment']
    .forEach(id => $(id).addEventListener('input', calculate));

  // Initialize on page load
  window.onload = calculate;
</script>
